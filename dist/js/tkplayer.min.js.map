{"version":3,"file":"tkplayer.min.js","sources":["tkplayer.js"],"sourcesContent":["const TKPlayer = {\r\n\telm: null,\r\n\taudio_elm: null,\r\n\tpanel_elm_name: null,\r\n\tpanel_elm_author: null,\r\n\tpanel_elm_cover: null,\r\n\tplay_button: null,\r\n\tprogress_selector: null,\r\n\tprogress_bar: null,\r\n\tprogress_base: null,\r\n\ttime_bar: null,\r\n\trecommend_source: \"https://api.cnsoft.top/tkplayer/\",\r\n\tmusic_info: {\r\n\t\tname: null,\r\n\t\tauthor: null,\r\n\t\tsrc: null,\r\n\t\tcover: null,\r\n\t},\r\n\tmax_song: null,\r\n\tnow_song: null,\r\n\tis_single: false,\r\n\tmusic_list: null,\r\n\r\n\t// 初始化信息状态\r\n\tinit() {\r\n\t\tthis.audio_elm.addEventListener(\"timeupdate\", this.sync_progress_bar.bind(this));\r\n\t\tthis.audio_elm.addEventListener(\"loadedmetadata\", this.output_time_text.bind(this));\r\n\t\tthis.progress_base.addEventListener(\"click\", (event) => this.compute_progress(event));\r\n\t\tthis.panel_elm_cover.addEventListener(\"dblclick\", this.close_player.bind(this));\r\n\t},\r\n\r\n\t// 获取播放状态\r\n\tis_paused() {\r\n\t\treturn !this.audio_elm.paused;\r\n\t},\r\n\r\n\t// 动态加载启动\r\n\tstart(args) {\r\n\t\tif (typeof args == \"object\" && !Array.isArray(args)) {\r\n\t\t\tthis.is_single = true;\r\n\t\t\tthis.inject_info(args);\r\n\t\t\t// 信息注入完成后，启动音乐播放器\r\n\t\t\tthis.startMusicPlayer();\r\n\t\t} else if (Array.isArray(args)) {\r\n\t\t\tthis.is_single = false;\r\n\t\t\tthis.source_list(args);\r\n\t\t\t// 信息注入完成后，启动音乐播放器\r\n\t\t\tthis.startMusicPlayer();\r\n\t\t} else if (args == false) {\r\n\t\t\tconsole.log(\"你选择了主动源启动，请注意是否提前准确地提供了资源列表~\");\r\n\t\t\t// 信息注入完成后，启动音乐播放器\r\n\t\t\tthis.startMusicPlayer();\r\n\t\t} else {\r\n\t\t\tconsole.log(\"你启动播放器尚未提供任何参数，这里为你主动推荐一首歌曲~\");\r\n\t\t\t// 异步请求这里就使用异步函数\r\n\t\t\tthis.is_single = true;\r\n\t\t\tthis.get_recommend_data()\r\n\t\t\t\t.then((info) => {\r\n\t\t\t\t\tthis.inject_info(info);\r\n\t\t\t\t\tthis.startMusicPlayer(); // 在这里启动播放器\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tconsole.error(\"获取推荐数据出错\");\r\n\t\t\t\t\talert(\"推荐源可能失效！\");\r\n\t\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\t// 播放和暂停音乐\r\n\tplay() {\r\n\t\tthis.change_play_icon();\r\n\t\tif (!this.is_paused()) {\r\n\t\t\tthis.audio_elm.play().catch((error) => {\r\n\t\t\t\talert(\"媒体解析失效，你提供的资源列表有问题！\");\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.audio_elm.pause();\r\n\t\t}\r\n\t},\r\n\r\n\t// 下一曲\r\n\tnext() {\r\n\t\tif (this.is_single) {\r\n\t\t\tthis.change_music();\r\n\t\t\tthis.play();\r\n\t\t} else {\r\n\t\t\tif (this.now_song == this.max_song - 1) {\r\n\t\t\t\tthis.now_song = 0;\r\n\t\t\t\tthis.inject_info(this.music_list[this.now_song]);\r\n\t\t\t\tthis.change_music();\r\n\t\t\t\tthis.play();\r\n\t\t\t} else {\r\n\t\t\t\tthis.now_song++;\r\n\t\t\t\tthis.inject_info(this.music_list[this.now_song]);\r\n\t\t\t\tthis.change_music();\r\n\t\t\t\tthis.play();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// 上一曲\r\n\tprev() {\r\n\t\tif (this.is_single) {\r\n\t\t\tthis.change_music();\r\n\t\t\tthis.play();\r\n\t\t} else {\r\n\t\t\tif (this.now_song <= 0) {\r\n\t\t\t\tthis.now_song = this.max_song - 1;\r\n\t\t\t\tthis.inject_info(this.music_list[this.now_song]);\r\n\t\t\t\tthis.change_music();\r\n\t\t\t\tthis.play();\r\n\t\t\t} else {\r\n\t\t\t\tthis.now_song--;\r\n\t\t\t\tthis.inject_info(this.music_list[this.now_song]);\r\n\t\t\t\tthis.change_music();\r\n\t\t\t\tthis.play();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// 获取歌曲时长\r\n\tget_allTime() {\r\n\t\treturn this.audio_elm.duration;\r\n\t},\r\n\r\n\t// 获取当前时长\r\n\tget_currentTime() {\r\n\t\treturn this.audio_elm.currentTime;\r\n\t},\r\n\r\n\t// 时长转换分秒\r\n\ttranslate_time(time) {\r\n\t\tlet time_single = Math.ceil(time);\r\n\t\tlet minute = Math.floor(time_single / 60);\r\n\t\tlet secend = time_single % 60;\r\n\t\treturn (minute < 10 ? \"0\" + minute : minute) + \":\" + (secend < 10 ? \"0\" + secend : secend);\r\n\t},\r\n\r\n\t// 输出文本时间进度\r\n\toutput_time_text() {\r\n\t\tthis.time_bar.innerText = this.translate_time(this.get_currentTime()) + \"/\" + this.translate_time(this.get_allTime());\r\n\t},\r\n\r\n\t// 改变播放按钮图标\r\n\tchange_play_icon() {\r\n\t\tthis.play_button.setAttribute(\"class\", this.is_paused() ? \"icon-play\" : \"icon-pause\");\r\n\t},\r\n\r\n\t// 同步进度条长度\r\n\tsync_progress_bar() {\r\n\t\tthis.progress_bar.style.width = (this.get_currentTime() / this.get_allTime()) * 100 + \"%\";\r\n\t\tthis.output_time_text();\r\n\t\tif (this.get_allTime() == this.get_currentTime()) {\r\n\t\t\tthis.play_button.setAttribute(\"class\", \"icon-play\");\r\n\t\t}\r\n\t},\r\n\r\n\t// 计算转换进度条进度\r\n\tcompute_progress(event) {\r\n\t\tlet all_Width = this.progress_base.offsetWidth;\r\n\t\tlet offset = event.offsetX;\r\n\t\tlet percent = offset / all_Width;\r\n\t\tif (isNaN(this.get_allTime())) {\r\n\t\t\tconsole.log(\"歌曲文件损坏，无法获取总时长！\");\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\tnewTime = this.get_allTime() * percent;\r\n\t\t\tthis.change_duration(newTime);\r\n\t\t}\r\n\t},\r\n\r\n\t// 手动修改进度\r\n\tchange_duration(newTime) {\r\n\t\tthis.audio_elm.currentTime = newTime;\r\n\t},\r\n\r\n\t// 切换音乐\r\n\tchange_music() {\r\n\t\tthis.change_duration(0);\r\n\t\tthis.sync_progress_bar();\r\n\t\tthis.audio_elm.paused = false;\r\n\t\tthis.play_button.setAttribute(\"class\", \"icon-play\");\r\n\t\tthis.panel_elm_name.innerText = this.music_info.name;\r\n\t\tthis.panel_elm_author.innerText = this.music_info.author;\r\n\t\tthis.panel_elm_cover.setAttribute(\"src\", this.music_info.cover);\r\n\t\tthis.audio_elm.setAttribute(\"src\", this.music_info.src);\r\n\t},\r\n\r\n\t// 启动音乐播放器\r\n\tstartMusicPlayer() {\r\n\t\t// 将模板写入到DOM中\r\n\t\tif (!document.getElementById(\"player\")) {\r\n\t\t\tdocument.querySelector(\"body\").innerHTML += `\r\n      <div class=\"player\" id=\"player\">\r\n        <div class=\"panel\">\r\n          <div class=\"media-info\">\r\n            <div class=\"title\">${this.music_info.name}</div>\r\n            <div class=\"author\">${this.music_info.author}</div>\r\n            <div class=\"controller\">\r\n              <span class=\"icon-backward\" title=\"上一曲\" onclick=\"TKPlayer.prev()\"></span>\r\n              <span class=\"icon-play\" id=\"play-button\" onclick=\"TKPlayer.play()\" title=\"播放/暂停\"></span>\r\n              <span class=\"icon-forward\" title=\"下一曲\" onclick=\"TKPlayer.next()\"></span>\r\n            </div>\r\n          </div>\r\n          <div class=\"progress\">\r\n            <div class=\"duration\">00:00/**:**</div>\r\n            <div class=\"progress-bar\" id=\"progress-bar\"></div>\r\n          </div>\r\n        </div>\r\n        <div class=\"cover\">\r\n          <img src=\"${this.music_info.cover}\" alt=\"cover\">\r\n        </div>\r\n        <audio src=\"${this.music_info.src}\" id=\"audio\"></audio>\r\n      </div>\r\n  \t`;\r\n\t\t} else {\r\n\t\t\talert(\"你已经创建播放器啦，无需再次创建哦！\");\r\n\t\t}\r\n\r\n\t\t// 初始化元素\r\n\t\tTKPlayer.elm = document.querySelector(\"#player\");\r\n\t\tTKPlayer.audio_elm = document.querySelector(\"#player #audio\");\r\n\t\tTKPlayer.play_button = document.querySelector(\"#player #play-button\");\r\n\t\tTKPlayer.progress_selector = document.querySelector(\"#player .progress\");\r\n\t\tTKPlayer.progress_bar = document.querySelector(\"#player #progress-bar\");\r\n\t\tTKPlayer.progress_base = document.querySelector(\"#player .progress\");\r\n\t\tTKPlayer.time_bar = document.querySelector(\"#player .progress .duration\");\r\n\t\tTKPlayer.panel_elm_name = document.querySelector(\"#player .title\");\r\n\t\tTKPlayer.panel_elm_author = document.querySelector(\"#player .author\");\r\n\t\tTKPlayer.panel_elm_cover = document.querySelector(\"#player .cover img\");\r\n\r\n\t\t// 初始化Player\r\n\t\tTKPlayer.init();\r\n\t},\r\n\r\n\t// 注入信息\r\n\tinject_info(info) {\r\n\t\tif (info.cover && info.src) {\r\n\t\t\tthis.music_info = {\r\n\t\t\t\tname: info.name || \"未命名歌曲\",\r\n\t\t\t\tauthor: info.author || \"未命名作者\",\r\n\t\t\t\tcover: info.cover,\r\n\t\t\t\tsrc: info.src,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tconsole.log(\"歌曲信息失效！\");\r\n\t\t}\r\n\t},\r\n\r\n\t// 处理资源列表\r\n\tsource_list(info) {\r\n\t\tconsole.log(\"正在注入灵魂中~\");\r\n\t\tthis.is_single = false;\r\n\t\tthis.music_list = info;\r\n\t\tthis.max_song = info.length;\r\n\t\tthis.now_song = 0;\r\n\t\tthis.music_info = info[this.now_song];\r\n\t},\r\n\r\n\t// 关闭播放器\r\n\tclose_player() {\r\n\t\tlet app = this.elm;\r\n\t\tlet parent = app.parentNode;\r\n\t\tparent.removeChild(app);\r\n\t},\r\n\r\n\t// 获取推荐数据(异步)\r\n\tget_recommend_data() {\r\n\t\tlet recommend_source = this.recommend_source;\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\txhr.open(\"GET\", recommend_source, true);\r\n\t\t\txhr.onerror = () => reject(new Error(\"请求出现错误\"));\r\n\t\t\txhr.onload = () => {\r\n\t\t\t\tif (xhr.status === 200) {\r\n\t\t\t\t\tresolve(JSON.parse(xhr.responseText));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(new Error(\"请求失败: \" + xhr.status));\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\txhr.send();\r\n\t\t});\r\n\t},\r\n};\r\n"],"names":["TKPlayer","elm","audio_elm","panel_elm_name","panel_elm_author","panel_elm_cover","play_button","progress_selector","progress_bar","progress_base","time_bar","recommend_source","music_info","name","author","src","cover","max_song","now_song","is_single","music_list","init","this","addEventListener","sync_progress_bar","bind","output_time_text","compute_progress","event","close_player","is_paused","paused","start","args","Array","isArray","source_list","startMusicPlayer","console","log","get_recommend_data","then","inject_info","info","catch","error","alert","play","change_play_icon","pause","next","change_music","prev","get_allTime","duration","get_currentTime","currentTime","translate_time","time","let","time_single","Math","ceil","minute","floor","secend","innerText","setAttribute","style","width","all_Width","offsetWidth","percent","offsetX","isNaN","newTime","change_duration","document","getElementById","querySelector","innerHTML","length","app","parentNode","removeChild","Promise","resolve","reject","xhr","XMLHttpRequest","open","onerror","Error","onload","status","JSON","parse","responseText","send"],"mappings":"AAAA,IAAMA,SAAW,CAChBC,IAAK,KACLC,UAAW,KACXC,eAAgB,KAChBC,iBAAkB,KAClBC,gBAAiB,KACjBC,YAAa,KACbC,kBAAmB,KACnBC,aAAc,KACdC,cAAe,KACfC,SAAU,KACVC,iBAAkB,mCAClBC,WAAY,CACXC,KAAM,KACNC,OAAQ,KACRC,IAAK,KACLC,MAAO,IACR,EACAC,SAAU,KACVC,SAAU,KACVC,UAAW,CAAA,EACXC,WAAY,KAGZC,OACCC,KAAKpB,UAAUqB,iBAAiB,aAAcD,KAAKE,kBAAkBC,KAAKH,IAAI,CAAC,EAC/EA,KAAKpB,UAAUqB,iBAAiB,iBAAkBD,KAAKI,iBAAiBD,KAAKH,IAAI,CAAC,EAClFA,KAAKb,cAAcc,iBAAiB,QAAS,GAAWD,KAAKK,iBAAiBC,CAAK,CAAC,EACpFN,KAAKjB,gBAAgBkB,iBAAiB,WAAYD,KAAKO,aAAaJ,KAAKH,IAAI,CAAC,CAC/E,EAGAQ,YACC,MAAO,CAACR,KAAKpB,UAAU6B,MACxB,EAGAC,MAAMC,GACc,UAAf,OAAOA,GAAqBC,MAAMC,QAAQF,CAAI,EAKvCC,MAAMC,QAAQF,CAAI,GAC5BX,KAAKH,UAAY,CAAA,EACjBG,KAAKc,YAAYH,CAAI,EAErBX,KAAKe,iBAAiB,GACJ,GAARJ,GACVK,QAAQC,IAAI,8BAA8B,EAE1CjB,KAAKe,iBAAiB,IAEtBC,QAAQC,IAAI,8BAA8B,EAE1CjB,KAAKH,UAAY,CAAA,EACjBG,KAAKkB,mBAAmB,EACtBC,KAAK,IACLnB,KAAKoB,YAAYC,CAAI,EACrBrB,KAAKe,iBAAiB,CACvB,CAAC,EACAO,MAAM,IACNN,QAAQO,MAAM,UAAU,EACxBC,MAAM,UAAU,CACjB,CAAC,IAzBFxB,KAAKH,UAAY,CAAA,EACjBG,KAAKoB,YAAYT,CAAI,EAErBX,KAAKe,iBAAiB,EAwBxB,EAGAU,OACCzB,KAAK0B,iBAAiB,EACjB1B,KAAKQ,UAAU,EAKnBR,KAAKpB,UAAU+C,MAAM,EAJrB3B,KAAKpB,UAAU6C,KAAK,EAAEH,MAAM,IAC3BE,MAAM,qBAAqB,CAC5B,CAAC,CAIH,EAGAI,OACK5B,KAAKH,YAIJG,KAAKJ,UAAYI,KAAKL,SAAW,EACpCK,KAAKJ,SAAW,EAKhBI,KAAKJ,QAAQ,GACbI,KAAKoB,YAAYpB,KAAKF,WAAWE,KAAKJ,SAAS,GAC/CI,KAAK6B,aAAa,EAClB7B,KAAKyB,KAAK,CAGb,EAGAK,OACK9B,KAAKH,YAIJG,KAAKJ,UAAY,EACpBI,KAAKJ,SAAWI,KAAKL,SAAW,EAKhCK,KAAKJ,QAAQ,GACbI,KAAKoB,YAAYpB,KAAKF,WAAWE,KAAKJ,SAAS,GAC/CI,KAAK6B,aAAa,EAClB7B,KAAKyB,KAAK,CAGb,EAGAM,cACC,OAAO/B,KAAKpB,UAAUoD,QACvB,EAGAC,kBACC,OAAOjC,KAAKpB,UAAUsD,WACvB,EAGAC,eAAeC,GACdC,IAAIC,EAAcC,KAAKC,KAAKJ,CAAI,EAC5BK,EAASF,KAAKG,MAAMJ,EAAc,EAAE,EACpCK,EAASL,EAAc,GAC3B,OAAQG,EAAS,GAAK,IAAMA,EAASA,GAAU,KAAOE,EAAS,GAAK,IAAMA,EAASA,EACpF,EAGAvC,mBACCJ,KAAKZ,SAASwD,UAAY5C,KAAKmC,eAAenC,KAAKiC,gBAAgB,CAAC,EAAI,IAAMjC,KAAKmC,eAAenC,KAAK+B,YAAY,CAAC,CACrH,EAGAL,mBACC1B,KAAKhB,YAAY6D,aAAa,QAAS7C,KAAKQ,UAAU,EAAI,YAAc,YAAY,CACrF,EAGAN,oBACCF,KAAKd,aAAa4D,MAAMC,MAAS/C,KAAKiC,gBAAgB,EAAIjC,KAAK+B,YAAY,EAAK,IAAM,IACtF/B,KAAKI,iBAAiB,EAClBJ,KAAK+B,YAAY,GAAK/B,KAAKiC,gBAAgB,GAC9CjC,KAAKhB,YAAY6D,aAAa,QAAS,WAAW,CAEpD,EAGAxC,iBAAiBC,GAChB+B,IAAIW,EAAYhD,KAAKb,cAAc8D,YAE/BC,EADS5C,EAAM6C,QACIH,EACvB,GAAII,MAAMpD,KAAK+B,YAAY,CAAC,EAE3B,OADAf,QAAQC,IAAI,iBAAiB,EACtB,CAAA,EAEPoC,QAAUrD,KAAK+B,YAAY,EAAImB,EAC/BlD,KAAKsD,gBAAgBD,OAAO,CAE9B,EAGAC,gBAAgBD,GACfrD,KAAKpB,UAAUsD,YAAcmB,CAC9B,EAGAxB,eACC7B,KAAKsD,gBAAgB,CAAC,EACtBtD,KAAKE,kBAAkB,EACvBF,KAAKpB,UAAU6B,OAAS,CAAA,EACxBT,KAAKhB,YAAY6D,aAAa,QAAS,WAAW,EAClD7C,KAAKnB,eAAe+D,UAAY5C,KAAKV,WAAWC,KAChDS,KAAKlB,iBAAiB8D,UAAY5C,KAAKV,WAAWE,OAClDQ,KAAKjB,gBAAgB8D,aAAa,MAAO7C,KAAKV,WAAWI,KAAK,EAC9DM,KAAKpB,UAAUiE,aAAa,MAAO7C,KAAKV,WAAWG,GAAG,CACvD,EAGAsB,mBAEMwC,SAASC,eAAe,QAAQ,EAyBpChC,MAAM,oBAAoB,EAxB1B+B,SAASE,cAAc,MAAM,EAAEC;;;;iCAID1D,KAAKV,WAAWC;kCACfS,KAAKV,WAAWE;;;;;;;;;;;;;sBAa5BQ,KAAKV,WAAWI;;sBAEhBM,KAAKV,WAAWG;;KAQpCf,SAASC,IAAM4E,SAASE,cAAc,SAAS,EAC/C/E,SAASE,UAAY2E,SAASE,cAAc,gBAAgB,EAC5D/E,SAASM,YAAcuE,SAASE,cAAc,sBAAsB,EACpE/E,SAASO,kBAAoBsE,SAASE,cAAc,mBAAmB,EACvE/E,SAASQ,aAAeqE,SAASE,cAAc,uBAAuB,EACtE/E,SAASS,cAAgBoE,SAASE,cAAc,mBAAmB,EACnE/E,SAASU,SAAWmE,SAASE,cAAc,6BAA6B,EACxE/E,SAASG,eAAiB0E,SAASE,cAAc,gBAAgB,EACjE/E,SAASI,iBAAmByE,SAASE,cAAc,iBAAiB,EACpE/E,SAASK,gBAAkBwE,SAASE,cAAc,oBAAoB,EAGtE/E,SAASqB,KAAK,CACf,EAGAqB,YAAYC,GACPA,EAAK3B,OAAS2B,EAAK5B,IACtBO,KAAKV,WAAa,CACjBC,KAAM8B,EAAK9B,MAAQ,QACnBC,OAAQ6B,EAAK7B,QAAU,QACvBE,MAAO2B,EAAK3B,MACZD,IAAK4B,EAAK5B,GACX,EAEAuB,QAAQC,IAAI,SAAS,CAEvB,EAGAH,YAAYO,GACXL,QAAQC,IAAI,UAAU,EACtBjB,KAAKH,UAAY,CAAA,EACjBG,KAAKF,WAAauB,EAClBrB,KAAKL,SAAW0B,EAAKsC,OACrB3D,KAAKJ,SAAW,EAChBI,KAAKV,WAAa+B,EAAKrB,KAAKJ,SAC7B,EAGAW,eACC8B,IAAIuB,EAAM5D,KAAKrB,IACFiF,EAAIC,WACVC,YAAYF,CAAG,CACvB,EAGA1C,qBACCmB,IAAIhD,EAAmBW,KAAKX,iBAC5B,OAAO,IAAI0E,QAAQ,CAACC,EAASC,KAC5B,IAAMC,EAAM,IAAIC,eAChBD,EAAIE,KAAK,MAAO/E,EAAkB,CAAA,CAAI,EACtC6E,EAAIG,QAAU,IAAMJ,EAAO,IAAIK,MAAM,QAAQ,CAAC,EAC9CJ,EAAIK,OAAS,KACO,MAAfL,EAAIM,OACPR,EAAQS,KAAKC,MAAMR,EAAIS,YAAY,CAAC,EAEpCV,EAAO,IAAIK,MAAM,SAAWJ,EAAIM,MAAM,CAAC,CAEzC,EACAN,EAAIU,KAAK,CACV,CAAC,CACF,CACD"}